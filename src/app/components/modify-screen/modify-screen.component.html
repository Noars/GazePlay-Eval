<div class="container mt-1">
  <div class="row">
    <div class="col">
      <div class="card shadow-lg">
        <div class="card-header bg-secondary text-center text-white fw-semibold">
          Modification de l’écran -> {{screenToModify.name}}
        </div>
        <div class="card-body fw-semibold text-center">
          <div class="mb-4 d-flex align-items-center justify-content-center">
            <label for="typeSelect" class="form-label me-3 mb-0 fw-semibold">Type d’écran :</label>
            <select id="typeSelect" class="form-select w-auto" [(ngModel)]="screenToModify.type" (ngModelChange)="changeTypeScreen($event)">
              <option [value]="transitionScreenConstModel">Écran de transition</option>
              <option [value]="instructionScreenConstModel">Écran d'instruction</option>
              <option [value]="stimuliScreenConstModel">Écran de stimuli</option>
            </select>
          </div>
          @if (screenToModify.type === transitionScreenConstModel) {
            <div class="card shadow-lg mb-3">
              <div class="card-header bg-secondary text-white fw-semibold">
                Informations écran transition
              </div>
              <div class="mt-4 px-3 mb-4 m-auto">
                <ul class="custom-list">
                  <li>
                    <div class="d-flex align-items-center mb-2">
                      <span class="list-dash">-</span>
                      <label class="form-label me-3 fw-semibold">Mettre un temps avant passage a l'écran suivant ?</label>
                      <div>
                        <div class="form-check form-check-inline mb-0">
                          <input class="form-check-input" type="checkbox" name="timeNextScreen" id="timeNextScreenY" (change)="screenToModify.values[0] = true" [checked]="screenToModify.values[0]">
                          <label class="form-check-label fw-semibold" for="timeNextScreenY">Oui</label>
                        </div>
                        <div class="form-check form-check-inline mb-0">
                          <input class="form-check-input" type="checkbox" name="timeNextScreen" id="timeNextScreenN" (change)="screenToModify.values[0] = false" [checked]="!screenToModify.values[0]">
                          <label class="form-check-label fw-semibold" for="timeNextScreenN">Non</label>
                        </div>
                      </div>
                    </div>
                  </li>
                  @if (screenToModify.values[0]) {
                    <div class="arrow-container mt-2">
                      <div class="arrow">
                        <span></span>
                      </div>
                      <div class="d-flex align-items-center mb-2">
                        <label class="form-label me-3 fw-semibold">Combien de temps ?</label>
                        <div class="input-group w-auto">
                          <input type="number" class="form-control" min="1" [(ngModel)]="screenToModify.values[1]">
                          <span class="input-group-text fw-semibold">secondes</span>
                        </div>
                      </div>
                    </div>
                  }
                  <li class="mt-4">
                    <div class="d-flex align-items-center mb-2">
                      <span class="list-dash">-</span>
                      <label class="form-label me-3 fw-semibold">Mettre une croix de fixation ?</label>
                      <div>
                        <div class="form-check form-check-inline mb-0">
                          <input class="form-check-input" type="checkbox" name="fixationCrossScreen" id="fixationCrossScreenY" (change)="screenToModify.values[2] = true" [checked]="screenToModify.values[2]">
                          <label class="form-check-label fw-semibold" for="fixationCrossScreenY">Oui</label>
                        </div>
                        <div class="form-check form-check-inline mb-0">
                          <input class="form-check-input" type="checkbox" name="fixationCrossScreen" id="fixationCrossScreenN" (change)="screenToModify.values[2] = false" [checked]="!screenToModify.values[2]">
                          <label class="form-check-label fw-semibold" for="fixationCrossScreenN">Non</label>
                        </div>
                      </div>
                    </div>
                  </li>
                  @if (screenToModify.values[2]) {
                    <div class="arrow-container mt-2">
                      <div class="arrow">
                        <span></span>
                      </div>
                      <ul class="custom-list">
                        <li>
                          <div class="d-flex align-items-center mt-2">
                            <span class="list-dash">-</span>
                            <label class="form-label me-3 fw-semibold">Mettre un temps de fixation ?</label>
                            <div>
                              <div class="form-check form-check-inline mb-0">
                                <input class="form-check-input" type="checkbox" name="fixationTimeScreen" id="fixationTimeScreenY" (change)="screenToModify.values[3] = true" [checked]="screenToModify.values[3]">
                                <label class="form-check-label fw-semibold" for="fixationTimeScreenY">Oui</label>
                              </div>
                              <div class="form-check form-check-inline mb-0">
                                <input class="form-check-input" type="checkbox" name="fixationTimeScreen" id="fixationTimeScreenN" (change)="screenToModify.values[3] = false" [checked]="!screenToModify.values[3]">
                                <label class="form-check-label fw-semibold" for="fixationTimeScreenN">Non</label>
                              </div>
                            </div>
                          </div>
                        </li>
                        @if (screenToModify.values[3]) {
                          <div class="arrow-container mt-2">
                            <div class="arrow">
                              <span></span>
                            </div>
                            <div class="d-flex align-items-center mb-2">
                              <label class="form-label me-3 fw-semibold">Combien de temps ?</label>
                              <div class="input-group w-auto">
                                <input type="number" class="form-control" min="1" [(ngModel)]="screenToModify.values[4]">
                                <span class="input-group-text fw-semibold">secondes</span>
                              </div>
                            </div>
                          </div>
                        }
                      </ul>
                    </div>
                  }
                </ul>
              </div>
            </div>
          } @else if (screenToModify.type === instructionScreenConstModel) {
            <div class="card shadow-lg mb-3">
              <div class="card-header bg-secondary text-white fw-semibold">
                Informations écran instruction
              </div>
              <div class="mt-4 px-3 mb-4 m-auto">
                <ul class="custom-list">
                  <li>
                    <div class="d-flex align-items-center mb-2">
                      <span class="list-dash">-</span>
                      <label class="form-label me-3 fw-semibold">Mettre un temps avant passage a l'écran suivant ?</label>
                      <div>
                        <div class="form-check form-check-inline mb-0">
                          <input class="form-check-input" type="checkbox" name="timeNextScreen" id="timeNextScreenY" (change)="screenToModify.values[0] = true" [checked]="screenToModify.values[0]">
                          <label class="form-check-label fw-semibold" for="timeNextScreenY">Oui</label>
                        </div>
                        <div class="form-check form-check-inline mb-0">
                          <input class="form-check-input" type="checkbox" name="timeNextScreen" id="timeNextScreenN" (change)="screenToModify.values[0] = false" [checked]="!screenToModify.values[0]">
                          <label class="form-check-label fw-semibold" for="timeNextScreenN">Non</label>
                        </div>
                      </div>
                    </div>
                  </li>
                  @if (screenToModify.values[0]) {
                    <div class="arrow-container mt-2">
                      <div class="arrow">
                        <span></span>
                      </div>
                      <div class="d-flex align-items-center mb-2">
                        <label class="form-label me-3 fw-semibold">Combien de temps ?</label>
                        <div class="input-group w-auto">
                          <input type="number" class="form-control" min="1" [(ngModel)]="screenToModify.values[1]">
                          <span class="input-group-text fw-semibold">secondes</span>
                        </div>
                      </div>
                    </div>
                  }
                  <li class="mt-4">
                    <div class="d-flex align-items-center">
                      <span class="list-dash">-</span>
                      <label class="form-label me-3 fw-semibold">Ajouter un/une Image, Vidéo, Texte ou Son ?</label>
                      <div>
                        <div class="form-check form-check-inline mb-0">
                          <input class="form-check-input" type="checkbox" name="addFile" id="addFileY" (change)="screenToModify.values[2] = true" [checked]="screenToModify.values[2]">
                          <label class="form-check-label fw-semibold" for="addFileY">Oui</label>
                        </div>
                        <div class="form-check form-check-inline mb-0">
                          <input class="form-check-input" type="checkbox" name="addFile" id="addFileN" (change)="screenToModify.values[2] = false" [checked]="!screenToModify.values[2]">
                          <label class="form-check-label fw-semibold" for="addFileN">Non</label>
                        </div>
                      </div>
                    </div>
                  </li>
                  @if (screenToModify.values[2]) {
                    <div class="arrow-container mt-2">
                      <div class="arrow">
                        <span></span>
                      </div>
                      <ul class="custom-list">
                        <li>
                          <div class="d-flex align-items-center mb-2">
                            <span class="list-dash">-</span>
                            <label class="form-label me-3 fw-semibold">Quel type d'élément voulez-vous choisir ?</label>
                            <div>
                              <select class="form-select" [(ngModel)]="screenToModify.values[3]" (ngModelChange)="changeTypeFile($event)">
                                <option value="Image">Image</option>
                                <option value="Video">Vidéo</option>
                                <option value="Texte">Texte</option>
                                <option value="Son">Son</option>
                              </select>
                            </div>
                          </div>
                        </li>
                        @if (typeFile === 'Image') {
                          <div class="arrow-container mt-2">
                            <div class="arrow">
                              <span></span>
                            </div>
                            <div class="d-flex align-items-center mb-2 gap-2">
                              <label for="imageFile" class="form-label flex-grow-1 me-2">Image à afficher</label>
                              <input class="form-control w-auto" type="file" id="imageFile" accept="image/*" (change)="getFile($event)">
                              <button class="btn btn-outline-secondary" type="button" data-bs-toggle="modal" data-bs-target="#filePreviewModal" [disabled]="!haveFile">
                                <i class="bi bi-eye"></i>
                              </button>
                            </div>
                          </div>
                        } @else if (typeFile === 'Video') {
                          <div class="arrow-container mt-2">
                            <div class="arrow">
                              <span></span>
                            </div>
                            <div class="d-flex align-items-center mb-2 gap-2">
                              <label for="videoFile" class="form-label flex-grow-1 me-2">Vidéo à afficher</label>
                              <input class="form-control w-auto" type="file" id="videoFile" accept="video/*" (change)="getFile($event)">
                              <button class="btn btn-outline-secondary" type="button" data-bs-toggle="modal" data-bs-target="#filePreviewModal" [disabled]="!haveFile">
                                <i class="bi bi-eye"></i>
                              </button>
                            </div>
                          </div>
                        } @else if (typeFile === 'Texte') {
                          <div class="arrow-container mt-2">
                            <div class="arrow">
                              <span></span>
                            </div>
                            <div class="d-flex align-items-center mb-2 gap-2">
                              <label class="form-label flex-grow-1 me-2">Texte à afficher</label>
                              <textarea class="form-control w-auto" rows="1" style="resize: none;" [(ngModel)]="textToRead" (ngModelChange)="getText($event)" placeholder="Écris ton texte"></textarea>
                              <button class="btn btn-primary d-flex align-items-center" (click)="playText()" [disabled]="textToRead == ''">
                                <i class="bi bi-play-fill"></i>
                              </button>
                            </div>
                          </div>
                        } @else if (typeFile === 'Son') {
                          <div class="arrow-container mt-2">
                            <div class="arrow">
                              <span></span>
                            </div>
                            <div class="d-flex align-items-center mb-2 gap-2">
                              <label for="soundFile" class="form-label flex-grow-1 me-2">Son à jouer</label>
                              <input class="form-control w-auto" type="file" id="soundFile" accept="audio/*" (change)="getFile($event)">
                              <button class="btn btn-outline-secondary" type="button" data-bs-toggle="modal" data-bs-target="#filePreviewModal" [disabled]="!haveFile">
                                <i class="bi bi-eye"></i>
                              </button>
                            </div>
                          </div>
                        }
                      </ul>
                    </div>
                  }
                  <li class="mt-4">
                    <div class="d-flex align-items-center">
                      <span class="list-dash">-</span>
                      <label class="form-label me-3 fw-semibold">Ajouter un bouton pour lancer l'évaluation ?</label>
                      <div>
                        <div class="form-check form-check-inline mb-0">
                          <input class="form-check-input" type="checkbox" name="addStartButton" id="addStartButtonY" (change)="screenToModify.values[5] = true" [checked]="screenToModify.values[5]">
                          <label class="form-check-label fw-semibold" for="addStartButtonY">Oui</label>
                        </div>
                        <div class="form-check form-check-inline mb-0">
                          <input class="form-check-input" type="checkbox" name="addStartButton" id="addStartButtonN" (change)="screenToModify.values[5] = false" [checked]="!screenToModify.values[5]">
                          <label class="form-check-label fw-semibold" for="addStartButtonN">Non</label>
                        </div>
                      </div>
                    </div>
                  </li>
                  @if (screenToModify.values[5]) {
                    <div class="arrow-container mt-2">
                      <div class="arrow">
                        <span></span>
                      </div>
                      <div class="d-flex align-items-center mb-2">
                        <label class="form-label me-3 fw-semibold">Combien de temps de fixation?</label>
                        <div class="input-group w-auto">
                          <input type="number" class="form-control" min="1" [(ngModel)]="screenToModify.values[6]">
                          <span class="input-group-text fw-semibold">secondes</span>
                        </div>
                      </div>
                    </div>
                  }
                </ul>
              </div>
            </div>
          } @else if (screenToModify.type === stimuliScreenConstModel) {
            <div class="card shadow-lg mb-3">
              <div class="card-header bg-secondary text-white fw-semibold">
                Informations écran stimuli
              </div>
              <div class="card-body">
                <div class="d-flex gap-4 align-items-center">
                  <div class="flex-grow-0" style="width: 60%;">
                    <ul class="custom-list">
                      <li>

                        <div class="d-flex align-items-center mb-2">
                          <span class="list-dash">-</span>
                          <label class="form-label me-3 fw-semibold">Combien de lignes ?</label>
                          <div class="input-group w-auto">
                            <input type="number" class="form-control" min="1" [(ngModel)]="screenToModify.values[0]">
                          </div>
                        </div>

                        <div class="d-flex align-items-center mb-2">
                          <span class="list-dash">-</span>
                          <label class="form-label me-3 fw-semibold">Combien de colonnes ?</label>
                          <div class="input-group w-auto">
                            <input type="number" class="form-control" min="1" [(ngModel)]="screenToModify.values[1]">
                          </div>
                        </div>

                        <div class="d-flex align-items-center mb-2">
                          <span class="list-dash">-</span>
                          <label class="form-label me-3 fw-semibold">Combien de stimuli ?</label>
                          <div class="input-group w-auto">
                            <input type="number" class="form-control" min="1" [max]="screenToModify.values[0] * screenToModify.values[1]" [(ngModel)]="screenToModify.values[2]">
                          </div>
                        </div>

                        <div class="d-flex align-items-center mb-2">
                          <span class="list-dash">-</span>
                          <label class="form-label me-3 fw-semibold">Temps de fixation ?</label>
                          <div class="input-group w-auto">
                            <input type="number" class="form-control" min="1" [(ngModel)]="screenToModify.values[3]">
                          </div>
                        </div>

                        <div class="d-flex align-items-center mb-2">
                          <span class="list-dash">-</span>
                          <label class="form-label me-3 fw-semibold">Mettre un temps avant passage à l'écran suivant ?</label>
                          <div>
                            <div class="form-check form-check-inline mb-0">
                              <input class="form-check-input" type="checkbox" name="timeNextScreenS" id="timeNextScreenSY" (change)="screenToModify.values[4] = true" [checked]="screenToModify.values[4]">
                              <label class="form-check-label fw-semibold" for="timeNextScreenSY">Oui</label>
                            </div>
                            <div class="form-check form-check-inline mb-0">
                              <input class="form-check-input" type="checkbox" name="timeNextScreenS" id="timeNextScreenSN" (change)="screenToModify.values[4] = false" [checked]="!screenToModify.values[4]">
                              <label class="form-check-label fw-semibold" for="timeNextScreenSN">Non</label>
                            </div>
                          </div>
                        </div>

                        @if (screenToModify.values[4]) {
                          <div class="arrow-container mt-2">
                            <div class="arrow"><span></span></div>
                            <div class="d-flex align-items-center mb-2">
                              <label class="form-label me-3 fw-semibold">Combien de temps ?</label>
                              <div class="input-group w-auto">
                                <input type="number" class="form-control" min="1" [(ngModel)]="screenToModify.values[5]">
                                <span class="input-group-text fw-semibold">secondes</span>
                              </div>
                            </div>
                          </div>
                        }

                        <div class="d-flex align-items-center mb-2">
                          <span class="list-dash">-</span>
                          <label class="form-label me-3 fw-semibold">Ordre des stimuli aléatoire ?</label>
                          <div>
                            <div class="form-check form-check-inline mb-0">
                              <input class="form-check-input" type="checkbox" name="randomStimuli" id="randomStimuliY" (change)="screenToModify.values[6] = true" [checked]="screenToModify.values[6]">
                              <label class="form-check-label fw-semibold" for="randomStimuliY">Oui</label>
                            </div>
                            <div class="form-check form-check-inline mb-0">
                              <input class="form-check-input" type="checkbox" name="randomStimuli" id="randomStimuliN" (change)="screenToModify.values[6] = false" [checked]="!screenToModify.values[6]">
                              <label class="form-check-label fw-semibold" for="randomStimuliN">Non</label>
                            </div>
                          </div>
                        </div>

                        <!--<div class="d-flex align-items-center mb-2">
                          <span class="list-dash">-</span>
                          <label class="form-label me-3 fw-semibold">Désactiver les stimuli après sélection ?</label>
                          <div>
                            <div class="form-check form-check-inline mb-0">
                              <input class="form-check-input" type="checkbox" name="disableStimuli" id="disableStimuliY" (change)="screenToModify.values[6] = true" [checked]="screenToModify.values[6]">
                              <label class="form-check-label fw-semibold" for="disableStimuliY">Oui</label>
                            </div>
                            <div class="form-check form-check-inline mb-0">
                              <input class="form-check-input" type="checkbox" name="disableStimuli" id="disableStimuliN" (change)="screenToModify.values[6] = false" [checked]="!screenToModify.values[6]">
                              <label class="form-check-label fw-semibold" for="disableStimuliN">Non</label>
                            </div>
                          </div>
                        </div>-->
                      </li>
                    </ul>
                  </div>

                  <div class="flex-grow-0" style="width: 40%;">
                    <div class="accordion" id="stimuli">
                      @for (stimuli of screenToModify.values[8]; let i = $index; track i) {
                        <div class="accordion-item">
                          <h2 class="accordion-header">
                            <button class="accordion-button collapsed fw-semibold" type="button"
                                    data-bs-toggle="collapse"
                                    [attr.data-bs-target]="'#collapse' + i"
                                    aria-expanded="false"
                                    [attr.aria-controls]="'collapse' + i">
                              Stimuli {{ i+1 }}
                            </button>
                          </h2>
                          <div [id]="'collapse' + i" class="accordion-collapse collapse" data-bs-parent="#stimuli">
                            <div class="d-flex align-items-center mb-2">
                              <span class="list-dash">-</span>
                              <label class="form-label me-3 fw-semibold">Position de l'image</label>
                              <div class="input-group w-auto">
                                <input type="number" class="form-control" min="1" [(ngModel)]="screenToModify.values[8][i][0]">
                              </div>
                            </div>
                            <div class="d-flex align-items-center mb-2 gap-2">
                              <label for="imageFile" class="form-label flex-grow-1 me-2">Image à afficher</label>
                              <input class="form-control w-auto" type="file" id="imageFile" accept="image/*" (change)="getStimuliFiles($event, i)">
                            </div>
                            <button class="btn btn-sm btn-danger" (click)="deleteStimuli(i)">
                              <i class="bi bi-trash"></i>
                              Supprimer le stimuli
                            </button>
                          </div>
                        </div>
                      }
                    </div>
                    <button class="btn btn-secondary mt-2" (click)="addStimuli()" [disabled]="screenToModify.values[8].length >= (screenToModify.values[0] * screenToModify.values[1])">Ajouter un stimuli</button>
                  </div>

                </div>
              </div>
            </div>

          }
        </div>
      </div>
    </div>
  </div>
</div>
<div class="d-flex justify-content-between mt-4">
  <button class="btn btn-primary" (click)="backToScreenList()">
    ← Sauvegarder et Retour
  </button>
</div>

<!-- Modals -->
<div class="modal fade" id="filePreviewModal" tabindex="-1" aria-labelledby="filePreviewLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content bg-dark">
      <div class="modal-header border-0">
        <h5 class="modal-title text-white" id="filePreviewLabel">Aperçu du fichier donné</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fermer"></button>
      </div>
      <div class="modal-body d-flex justify-content-center">
        @if (typeFile === 'Image') {
          <img [src]="file" alt="Preview" class="img-fluid rounded shadow">
        } @else if (typeFile === 'Video') {
          <video [src]="file" controls class="img-fluid rounded shadow"></video>
        } @else if (typeFile === 'Son') {
          <audio controls>
            <source [src]="file" type="audio/mpeg">
          </audio>
        }
      </div>
    </div>
  </div>
</div>
