<div class="d-flex justify-content-center align-items-start bg-light-subtle p-4">
  <div class="card shadow-lg w-100" style="max-width: 600px;">
    <div class="card-header text-center">
      <h3 class="mb-0">Paramètres globaux évaluation manuelle</h3>
    </div>
    <div class="card-body">
      <div class="d-flex justify-content-center align-items-center gap-4">
        <label class="fw-semibold mb-0">
          Voulez‑vous faire des paramètres globaux ?
        </label>
        <div class="form-check mb-0">
          <input
            type="checkbox"
            class="form-check-input"
            id="globalYes"
            (change)="useGlobalParams = true"
            [checked]="useGlobalParams"
          />
          <label class="form-check-label" for="globalYes">Oui</label>
        </div>
        <div class="form-check mb-0">
          <input
            type="checkbox"
            class="form-check-input"
            id="globalNo"
            (change)="useGlobalParams = false"
            [checked]="!useGlobalParams"
          />
          <label class="form-check-label" for="globalNo">Non</label>
        </div>
      </div>
      @if (useGlobalParams) {
        <div class="accordion mt-4" id="globalParamsAccordion">
          <div class="accordion-item">
            <h2 class="accordion-header" id="headingTrans">
              <button class="accordion-button collapsed" type="button"
                      data-bs-toggle="collapse"
                      data-bs-target="#collapseTrans"
                      aria-expanded="false"
                      aria-controls="collapseTrans">
                Écrans de transition
              </button>
            </h2>
            <div id="collapseTrans" class="accordion-collapse collapse"
                 aria-labelledby="headingTrans"
                 data-bs-parent="#globalParamsAccordion">
              <div class="accordion-body">
                <div class="mb-4">
                  <label class="form-label fw-semibold">Quel type de transition ?</label>
                  <div class="input-group mx-auto mb-3" style="max-width: 350px;">
                    <select class="form-select" [(ngModel)]="selectedTransition">
                      @for (option of transitionTypes; let idx = $index; track idx) {
                        <option [value]="option">{{ option }}</option>
                      }
                    </select>
                    <span
                      class="input-group-text bg-primary-subtle border-start-0"
                      [matTooltip]="getInfoTransition()"
                      matTooltipClass="custom-tooltip-class"
                      matTooltipPosition="right">
                      <i class="bi bi-info-circle"></i>
                    </span>
                  </div>
                </div>
                @if (selectedTransition === 'Écran noir') {
                  <div class="mb-4">
                    <label class="form-label fw-semibold">Méthode de passage à l’écran suivant</label>
                    <select
                      class="form-select"
                      [(ngModel)]="selectedMethod">
                      @for (method of navigationMethods; let idx = $index; track idx) {
                        <option [value]="method">{{ method }}</option>
                      }
                    </select>
                  </div>
                }
              </div>
            </div>
          </div>
          <div class="accordion-item">
            <h2 class="accordion-header" id="headingStim">
              <button class="accordion-button collapsed" type="button"
                      data-bs-toggle="collapse"
                      data-bs-target="#collapseStim"
                      aria-expanded="false"
                      aria-controls="collapseStim">
                Écrans de stimuli
              </button>
            </h2>
            <div id="collapseStim" class="accordion-collapse collapse"
                 aria-labelledby="headingStim"
                 data-bs-parent="#globalParamsAccordion">
              <div class="accordion-body">
                <div class="mb-4">
                  <label class="form-label fw-semibold">Taille de la grille ?</label>
                  <div class="row g-3 align-items-center">
                    <div class="col-4">
                      <label for="nbRows" class="col-form-label">Nombre de lignes</label>
                    </div>
                    <div class="col-4">
                      <input type="number" id="nbRows" class="form-control" min="1" step="1" aria-describedby="nbRowsInfo" [(ngModel)]="screenStimuliInfos[0]">
                    </div>
                    <div class="col-4">
                      <span id="nbRowsInfo" class="form-text fw-semibold">
                        Minimum 1 !
                      </span>
                    </div>
                  </div>
                  <div class="row g-3 align-items-center">
                    <div class="col-4">
                      <label for="nbCols" class="col-form-label">Nombre de colonnes</label>
                    </div>
                    <div class="col-4">
                      <input type="number" id="nbCols" class="form-control" min="1" step="1" aria-describedby="nbColsInfo" [(ngModel)]="screenStimuliInfos[1]">
                    </div>
                    <div class="col-4">
                      <span id="nbColsInfo" class="form-text fw-semibold">
                        Minimum 1 !
                      </span>
                    </div>
                  </div>
                </div>
                <br>
                <div class="mb-4">
                  <label class="form-label fw-semibold">Temps maximum par écran ?</label>
                  <div class="d-flex justify-content-center align-items-center gap-4">
                    <label class="col-form-label">
                      Mettre un temps maximum par écran ?
                    </label>
                    <div class="form-check mb-0">
                      <input
                        type="checkbox"
                        class="form-check-input"
                        id="timeScreenYes"
                        (change)="screenStimuliInfos[2] = 'true'"
                        [checked]="screenStimuliInfos[2] === 'true'"
                      />
                      <label class="form-check-label" for="timeScreenYes">Oui</label>
                    </div>
                    <div class="form-check mb-0">
                      <input
                        type="checkbox"
                        class="form-check-input"
                        id="timeScreenNo"
                        (change)="screenStimuliInfos[2] = 'false'"
                        [checked]="screenStimuliInfos[2] === 'false'"
                      />
                      <label class="form-check-label" for="timeScreenNo">Non</label>
                    </div>
                  </div>
                  @if (screenStimuliInfos[2] === 'true') {
                    <div class="row g-3 align-items-center justify-content-center">
                      <div class="col-auto">
                        <input type="number" id="maxTimeScreen" class="form-control" min="1" step="1" aria-describedby="maxTimeScreenInfo" [(ngModel)]="screenStimuliInfos[3]">
                      </div>
                      <div class="col-auto">
                      <span id="nbFixationLengthInfo" class="form-text fw-semibold">
                        La durée est en secondes !
                      </span>
                      </div>
                    </div>
                  }
                </div>
                <br>
                <div class="mb-4">
                  <label class="form-label fw-semibold">Durée de fixation pour validation ?</label>
                  <div class="row g-3 align-items-center justify-content-center">
                    <div class="col-auto">
                      <input type="number" id="nbFixationLength" class="form-control" min="0.1" step="0.1" aria-describedby="nbFixationLengthInfo" [(ngModel)]="screenStimuliInfos[4]">
                    </div>
                    <div class="col-auto">
                      <span id="nbFixationLengthInfo" class="form-text fw-semibold">
                        La durée est en secondes !
                      </span>
                    </div>
                  </div>
                </div>
                <br>
                <div class="mb-4">
                  <label class="form-label fw-semibold">Nombre de stimuli a valider pour passage a l'écran suivant ?</label>
                  <div class="row g-3 align-items-center justify-content-center">
                    <div class="col-auto">
                      <input type="number" id="nbStimuli" class="form-control" min="1" [max]="Number(screenStimuliInfos[0]) * Number(screenStimuliInfos[1])" step="1" aria-describedby="nbStimuliInfo" [(ngModel)]="screenStimuliInfos[5]">
                    </div>
                    <div class="col-auto">
                      <span id="nbStimuliInfo" class="form-text fw-semibold">
                        Maximum nombre de lignes * nombre de colonnes ({{Number(screenStimuliInfos[0]) * Number(screenStimuliInfos[1])}}) !
                      </span>
                    </div>
                  </div>
                </div>
                <br>
                <div class="mb-4">
                  <label class="form-label fw-semibold">Qu’est-ce qu’il se passe si le stimuli est validé ?</label>
                  <div class="d-flex justify-content-center align-items-center gap-4">
                    <label class="col-form-label">Désactivation de celui-ci ?</label>
                    <div class="form-check mb-0">
                      <input
                        type="checkbox"
                        class="form-check-input"
                        id="disableStimuliYes"
                        (change)="screenStimuliInfos[6] = 'true'"
                        [checked]="screenStimuliInfos[6] === 'true'"
                      />
                      <label class="form-check-label" for="disableStimuliYes">Oui</label>
                    </div>
                    <div class="form-check mb-0">
                      <input
                        type="checkbox"
                        class="form-check-input"
                        id="disableStimuliNo"
                        (change)="screenStimuliInfos[6] = 'false'"
                        [checked]="screenStimuliInfos[6] === 'false'"
                      />
                      <label class="form-check-label" for="disableStimuliNo">Non</label>
                    </div>
                  </div>
                </div>
                <br>
                <div class="mb-4">
                  <label class="form-label fw-semibold">Emplacement stimuli ?</label>
                  <div class="d-flex justify-content-center align-items-center gap-4">
                    <label class="col-form-label">
                      Placer les stimuli aléatoirement ?
                    </label>
                    <div class="form-check mb-0">
                      <input
                        type="checkbox"
                        class="form-check-input"
                        id="randomStimuliYes"
                        (change)="screenStimuliInfos[7] = 'true'"
                        [checked]="screenStimuliInfos[7] === 'true'"
                      />
                      <label class="form-check-label" for="randomStimuliYes">Oui</label>
                    </div>
                    <div class="form-check mb-0">
                      <input
                        type="checkbox"
                        class="form-check-input"
                        id="randomStimuliNo"
                        (change)="screenStimuliInfos[7] = 'false'"
                        [checked]="screenStimuliInfos[7] === 'false'"
                      />
                      <label class="form-check-label" for="randomStimuliNo">Non</label>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      }
      <div class="d-flex justify-content-center align-items-start mt-4">
        <button class="btn btn-primary" (click)="startCreateEvalManual()">
          Commencer la création manuelle de l'évaluation
        </button>
      </div>
      <div class="d-flex justify-content-between mt-4">
        <button class="btn btn-primary" (click)="backToEvalChoice()">
          ← Retour
        </button>
      </div>
    </div>
  </div>
</div>
